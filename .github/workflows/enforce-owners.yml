# .github/workflows/main-approval-deploy.yml


on:
  pull_request:
    branches:
      - main   # âœ… enforce approval for PRs into main
  push:
    branches:
      - main   # âœ… deploy after merge to main

jobs:
  approval-check:
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    environment: main-protection   # ðŸ‘ˆ requires environment approval
    steps:
      - name: Enforce Approval
        run: echo "âœ… Approval enforced via environment reviewers"

  deploy:
    if: github.event_name == 'push'
    runs-on: ubuntu-latest
    environment: main-protection   # ðŸ‘ˆ also requires approval before deploying
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Deploy with secret
        run: echo "Using secret ${{ secrets.PROD_API_KEY }}"
